<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Waliko Car Hire Company</title>
  <style>
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: #eef2f3;
      color: #333333;
      line-height: 1.6;
    }
    .header {
  display: flex;
  align-items: center;
  background: #075ad8;
  color: #fff;
  padding: 6px 20px;
  flex-wrap: wrap;

  position: fixed;       /* ğŸ‘ˆ makes it fixed */
  top: 0;                /* ğŸ‘ˆ stick to top */
  left: 0;
  width: 100%;           /* ğŸ‘ˆ full width */
  z-index: 1000;         /* ğŸ‘ˆ stay on top */
}

    .left-section {
      font-size: 24px;
      font-weight: bold;
    }
    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-left: auto;
      flex-wrap: wrap;
    }
    .nav-links a {
      text-decoration: none;
      color: #fff;
      font-size: 16px;
      padding: 10px 14px;
      background: #3498db;
      border-radius: 5px;
      transition: background 0.3s ease;
      cursor: pointer;
    }
    .nav-links a:hover {
      background: #2980b9;
    }
    /* Content Area */
    #content {
  padding: 115px 20px 20px 20px; /* â¬…ï¸ push everything down */
  max-width: 1200px;
  margin: 20px auto;
  text-align: left;
}






    /* Home Notice (Red) */
    .notice {
      background: #ffdddd;
      border-left: 5px solid #002fff;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 5px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .notice h2 {
      margin-bottom: 15px;
      color: #a80000;
    }
    .notice p {
      margin-bottom: 10px;
      font-size: 16px;
    }
    .instructions {
      margin-top: 15px;
      font-size: 15px;
      line-height: 1.5;
    }
/* Car Cards Container */
        .car-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0;
    }
    .car-card {
      background: #fff;
      flex: 1 1 calc(33.33% - 0px);
      min-width: 300px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      margin: 0;
    }
    .car-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .car-details {
      padding: 15px;
    }
    .car-details h3 {
      margin-bottom: 10px;
      font-size: 20px;
    }
    .car-details p {
      margin-bottom: 8px;
      color: #555;
      font-size: 15px;
    }
    .book-btn {
      text-decoration: none;
      color: #fff;
      font-size: 16px;
      padding: 8px 12px;
      background: #082aec;
      border-radius: 5px;
      transition: background 0.3s ease;
      cursor: pointer;
      position: absolute;
      bottom: 15px;
      right: 15px;
    }
    .book-btn:hover {
      background: #f30928;
    }
   /* Booking Details */
.booking-details {
  background: #fff;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 20px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  max-width: 900px; /* Adjust this value as needed */
  margin-left: auto;
  margin-right: auto;
}
.booking-info {
  flex: 60;
  min-width: 250px;
}
.booking-info p {
  margin: 8px 0;
  font-size: 15px;
}
    .pending {
      color: #c0392b;
      font-weight: bold;
      margin-top: 10px;
    }
    .booking-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
    }
    .pay-btn, .delete-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      width: 100px;
    }
    .pay-btn {
      background: #1d0eee;
      color: #fff;
    }
    .pay-btn:hover {
      background: #1c5980;
    }
    .delete-btn {
      background: #e74c3c;
      color: #fff;
    }
    .delete-btn:hover {
      background: #c0392b;
    }
    /* Payment Statements Note & Receipt Button */
    .payment-note {
      background: #ffdddd;
      border: 1px solid #ff0000;
      padding: 15px;
      border-radius: 5px;
      font-size: 16px;
      color: #a80000;
      margin-bottom: 20px;
    }
    .receipt-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .receipt-btn:hover {
      background: #c0392b;
    }
    /* Receipt Modal */
    .receipt-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      overflow: auto;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .receipt-content {
      background: #fff;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      border-radius: 5px;
      position: relative;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      text-align: left;
    }
    .receipt-content h2 {
      margin-bottom: 15px;
      color: #2c3e50;
    }
    .receipt-content p {
      margin-bottom: 10px;
      font-size: 15px;
    }
    .close-receipt {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #333;
    }
    /* Modal Styles (Booking, Mpesa, Payment Failed) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      overflow: auto;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      border-radius: 5px;
      position: relative;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    .modal-content h2 {
      margin-bottom: 15px;
      color: #2c3e50;
    }
    .modal-content label {
      display: block;
      margin: 12px 0 5px;
      font-size: 15px;
    }
    .modal-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 15px;
    }
    .modal-content button {
      padding: 10px 15px;
      background: #27ae60;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 15px;
      transition: background 0.3s ease;
    }
    .modal-content button:hover {
      background: #1e8449;
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #333;
    }
    /* Animation Overlay with Spinner */
    .animation-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .spinner {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #2980b9;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Payment Failed Popup (Red Message with Try Again) */
    .payment-failed {
      background: #ffdddd;
      border: 2px solid #ff0000;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
    }
    .payment-failed p {
      margin-bottom: 15px;
      font-size: 16px;
      color: #a80000;
    }
    .try-again-link {
      color: #ff0000;
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
    }
    @media (max-width: 768px) {
  /* Make headers smaller */
  h1 {
    font-size: 20px;
  }
  h2 {
    font-size: 18px;
  }
  h3 {
    font-size: 16px;
  }

  /* Make buttons smaller */
  button,
  .nav-links a,
  .book-btn,
  .pay-btn,
  .delete-btn,
  .receipt-btn,
  .modal-content button {
    font-size: 14px;
    padding: 6px 10px;
  }
}

  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="left-section"> <h5> Waliko Car Hire </h5></div>
    <nav class="nav-links">
     
      <a id="homeLink">Home</a>
      <a id="carsLink">Cars</a>
      <a id="bookingDetailsLink">Booking Details</a>
      <a id="paymentsLink"> Payments</a>
      <a href="account.html">Account</a>
      <a href="feedback.html">Feedback</a>
      <a id="logoutLink">Logout</a>
    </nav>
  </header>

  <!-- Content Area -->
  <div id="content">
    <p>Click "Home" to view system instructions.</p>
  </div>

  <!-- Booking Modal -->
  <div id="bookingModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="closeBookingModal">&times;</span>
      <h2>Book Car</h2>
      <form id="bookingForm">
        <label for="nationalid">National ID</label>
        
        <input type="text" id="nationalId" placeholder="Enter National ID" required />
        <label for="tel">Phone Number</label>
        <input type="number" id="phone" placeholder="Enter Phone Number">
        <label for="license">Driver Licence No.</label>
        <input type="text" id="license" placeholder="Enter Licence Number" required />
        <label for="pickup">Renting Start Date</label>
        <input type="date" id="pickup" required />
        <label for="endDate">Renting End Date</label>
        <input type="date" id="endDate" required />
      
        <button type="submit">Submit Booking</button>
      </form>
    </div>
  </div>

  <!-- Mpesa Modal -->
  <div id="mpesaModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="closeMpesaModal">&times;</span>
      <h2>Enter Mpesa Number</h2>
      <label for="mpesaNo">Mpesa Number:</label>
      <input type="text" id="mpesaNo" placeholder="10 digits" />
      <button id="submitMpesa">Submit Payment</button>
    </div>
  </div>

  <!-- Animation Overlay with Spinner -->
  <div id="animationOverlay" class="animation-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Payment Failed Popup Modal -->
  <div id="paymentFailedModal" class="modal">
    <div class="modal-content payment-failed">
      <span class="close-modal" id="closePaymentFailed">&times;</span>
      <p> Unexpected Error Acquired</p>
      <p class="try-again-link" id="tryAgainLink">Try Again</p>
    </div>
  </div>

  <!-- Receipt Modal -->
  <div id="receiptModal" class="receipt-modal">
    <div class="receipt-content">
      <span class="close-receipt" id="closeReceipt">&times;</span>
      <h2>Receipt Details</h2>
      <p>Dear customer, to receive your receipt, you must book a car and pay for it,Thank you!.</p>
    
    </div>
  </div>
  

  <script>
    // Car data array (prices in Ksh)
    const cars = [
      { name: "Toyota Prado TX", price: 12000, description: "Luxury SUV with 4WD.", image: "car1.jpg", available: true, duration: "24 hours" },
      { name: "Subaru Forester", price: 7000, description: "Reliable and fuel-efficient.", image: "car2.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Harrier", price: 8000, description: "Comfortable sedan.", image: "car3.jpg", available: true, duration: "24 hours" },
      
      { name: "Mercedes Benz C200", price: 10000, description: "Luxury executive car.", image: "car5.jpg", available: true, duration: "24 hours" },
      { name: "Range Rover Sport", price: 25000, description: "Premium off-road vehicle.", image: "car6.jpg", available: true, duration: "24 hours" },
      { name: "Mazda CX-5", price: 6000, description: "Stylish and fuel-efficient.", image: "car7.jpg", available: true, duration: "24 hours" },
      { name: "Honda CR-V", price: 6500, description: "Compact SUV with great mileage.", image: "car8.jpg", available: true, duration: "24 hours" },
      { name: "Hyundai Tucson", price: 10000, description: "Comfortable crossover with modern features.", image: "car9.jpg", available: true, duration: "24 hours" },
      { name: "Subaru Impreza", price: 6000, description: "Sporty and efficient AWD sedan.", image: "car10.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Vitz", price: 3500, description: "Compact and fuel-efficient city car.", image: "car11.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Wish", price: 4000, description: "Spacious MPV with great reliability.", image: "car12.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Prado TXL", price: 13000, description: "Advanced SUV with a powerful engine.", image: "car13.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Axio", price: 5000, description: "Reliable and fuel-efficient compact sedan ideal for city and highway driving.", image: "car17.jpg", available: true, duration: "24 hours" },
{ name: "Toyota Fielder", price: 4000, description: "Spacious and versatile station wagon perfect for families and cargo transport.", image: "car18.jpg", available: true, duration: "24 hours" },

      { name: "Toyota Prado TXG", price: 13500, description: "High-performance version of the TXL with luxury features.", image: "car14.jpg", available: true, duration: "24 hours" },
      { name: "Toyota Land Cruiser V8", price: 14000, description: "Powerful full-size SUV with superior off-road capabilities.", image: "car15.jpg", available: true, duration: "24 hours" }
      
    ];

    // DOM References
    const contentDiv = document.getElementById('content');
    const homeLink = document.getElementById('homeLink');
    const carsLink = document.getElementById('carsLink');
    const bookingDetailsLink = document.getElementById('bookingDetailsLink');
    const logoutLink = document.getElementById('logoutLink');
    const paymentsLink = document.getElementById('paymentsLink');

    const bookingModal = document.getElementById('bookingModal');
    const closeBookingModalBtn = document.getElementById('closeBookingModal');
    const bookingForm = document.getElementById('bookingForm');
    const animationOverlay = document.getElementById('animationOverlay');

    const mpesaModal = document.getElementById('mpesaModal');
    const closeMpesaModalBtn = document.getElementById('closeMpesaModal');
    const submitMpesaBtn = document.getElementById('submitMpesa');
    const mpesaNoInput = document.getElementById('mpesaNo');

    const paymentFailedModal = document.getElementById('paymentFailedModal');
    const closePaymentFailedBtn = document.getElementById('closePaymentFailed');
    const tryAgainLink = document.getElementById('tryAgainLink');

    const receiptModal = document.getElementById('receiptModal');
    const closeReceiptBtn = document.getElementById('closeReceipt');

    let currentCar = null; // For booking
    let currentBookingIndex = null; // For Mpesa payment

    // --- Home View ---
    function renderHome() {
      contentDiv.innerHTML = `
        <div class="notice">
          <h2>Welcome to Waliko Car Hire</h2>
          <p>* This system allows you to view and book available cars.</p>
          <p>* Click "Cars" to see our fleet and "Book Now" on available vehicles.</p>
          <p>* After booking, go to "Booking Details" to see your pending bookings. You can cancel your booking by clicking the Delete button or pay .</p>
          <p>* Once you pay for your booking, your payment will reflect in the Payment button .</p>
          <p>* To get a receipt, click the "Get Receipt" button in Payment Button. Get your receipt there.</p>
          
         By clicking on "Account" button it gives you access to your personal information, lets you change your password, find the help center, and even handle account deletion or deactivation.
          <p>* Thank you for choosing Waliko Car Hire!</p>
        </div>
      `;
    }

    // --- Cars View ---
    function renderCars() {
      contentDiv.innerHTML = '<div class="car-container"></div>';
      const container = document.querySelector('.car-container');
      cars.forEach((car, index) => {
        const card = document.createElement('div');
        card.className = 'car-card';
        card.innerHTML = `
          <img src="${car.image}" alt="${car.name}">
          <div class="car-details">
            <h3>${car.name}</h3>
            <p><strong>Price:</strong> Ksh ${car.price}</p>
            <p>${car.description}</p>
            <p><strong>Duration:</strong> ${car.duration}</p>
            <p><strong>Available:</strong> ${car.available ? 'Yes' : 'No'}</p>
          </div>
        `;
        if(car.available) {
          const bookBtn = document.createElement('a');
          bookBtn.className = 'book-btn';
          bookBtn.textContent = "Book Now";
          bookBtn.addEventListener('click', () => {
            currentCar = { ...car, index };
            openBookingModal();
          });
          card.appendChild(bookBtn);
        }
        container.appendChild(card);
      });
    }

    // --- Booking Modal Functions ---
    function openBookingModal() {
      bookingModal.style.display = 'flex';
    }
    function closeBookingModal() {
      bookingModal.style.display = 'none';
      bookingForm.reset();
    }
    bookingForm.addEventListener('submit', function(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const nationalId = document.getElementById('nationalId').value.trim();
Â  Â  Â  const license = document.getElementById('license').value.trim();
Â  Â  Â  const phone = document.getElementById('phone').value.trim(); // Get phone number
Â  Â  Â  const pickup = document.getElementById('pickup').value;
Â  Â  Â  const endDate = document.getElementById('endDate').value;

Â  Â  Â  // Validate required fields
Â  Â  Â  if (!nationalId || !license || !phone || !pickup || !endDate) { // Include phone in validation
Â  Â  Â  Â  alert("Error: Please fill in all booking fields including Phone Number, Renting Start Date and Renting End Date.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Validate Phone Number (exactly 10 digits and starts with '07')
Â  Â  Â  if (phone.length !== 10 || !phone.startsWith('07')) {
Â  Â  Â  Â  alert("Error: Phone number must be exactly 10 digits and start with '07'.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Validate National ID (not less than 7 digits)
Â  Â  Â  if (!/^\d{7,}$/.test(nationalId)) {
Â  Â  Â  Â  alert("Error: National ID should be at least 7 digits.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Validate Driver's License (not less than 7 characters: letters and digits)
Â  Â  Â  if (!/^[a-zA-Z0-9]{7,}$/.test(license)) {
Â  Â  Â  Â  alert("Error: Licence No. should be at least 7 characters long and contain only letters and digits.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Validate that End Date is later than Pick Up Date
Â  Â  Â  if (new Date(endDate) <= new Date(pickup)) {
Â  Â  Â  Â  alert("Error: Renting End Date must be later than Renting Start Date.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Generate a unique booking ID
Â  Â  Â  const bookingId = 'BOOK' + Date.now() + Math.floor(Math.random() * 1000);

Â  Â  Â  // Save booking immediately
Â  Â  Â  const bookingDetails = {
Â  Â  Â  Â  carName: currentCar.name,
Â  Â  Â  Â  bookingId, // Use the unique ID as bookingId
Â  Â  Â  Â  nationalId,
Â  Â  Â  Â  license,
Â  Â  Â  Â  phone, // Save the phone number
Â  Â  Â  Â  pickup,
Â  Â  Â  Â  endDate,
Â  Â  Â  Â  price: currentCar.price
Â  Â  Â  };
Â  Â  Â  let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
Â  Â  Â  bookings.push(bookingDetails);
Â  Â  Â  localStorage.setItem('bookings', JSON.stringify(bookings));
Â  Â  Â  alert("Booking confirmed! check it at Booking Details");
Â  Â  Â  closeBookingModal();
Â  Â  });
  // --- Booking Details View ---
  Â  Â  function renderBookingDetails() {
Â  Â  Â  contentDiv.innerHTML = '<h2>Booking Details</h2>';
Â  Â  Â  let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
Â  Â  Â  if (bookings.length === 0) {
Â  Â  Â  Â  contentDiv.innerHTML += "<p>No bookings made yet.</p>";
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  bookings.forEach((booking, idx) => {
Â  Â  Â  Â  // Create a flex container to separate details (left) from actions (right)
Â  Â  Â  Â  const container = document.createElement('div');
Â  Â  Â  Â  container.className = 'booking-details';
Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  <div class="booking-info">
Â  Â  Â  Â  Â  Â  <p><strong>Car:</strong> ${booking.carName}</p>
Â  Â  Â  Â  Â  Â  <p><strong>Booking ID:</strong> ${booking.bookingId}</p>
Â  Â  Â  Â  Â  Â  <p><strong>National ID:</strong> ${booking.nationalId}</p>
Â  Â  Â  Â  Â  Â  <p><strong>Phone:</strong> ${booking.phone}</p>
Â  Â  Â  Â  Â  Â  <p><strong>Licence No.:</strong> ${booking.license}</p>
Â  Â  Â  Â  Â  Â  <p><strong>Renting Start Date:</strong> ${booking.pickup}</p>
Â  Â  Â  Â  Â  Â  <p><strong>Renting End Date:</strong> ${booking.endDate}</p>
Â  Â  Â  Â  Â  Â  <p class="pending">Pending payment: Pay half of the rental fees which is (Ksh ${Math.floor(booking.price/2)}) to confirm your booking,The remaining balance will be paid when picking up the car.</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="booking-actions">
Â  Â  Â  Â  Â  Â  <a href="payment-gateway.html?booking_id=${booking.bookingId}" class="pay-btn">Pay</a>
Â  Â  Â  Â  Â  Â  <button class="delete-btn" data-index="${idx}">Delete</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  contentDiv.appendChild(container);
Â  Â  Â  });
Â  Â  Â  // Attach event listeners for Pay and Delete buttons
Â  Â  Â  document.querySelectorAll('.pay-btn').forEach(btn => {
Â  Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  currentBookingIndex = e.target.getAttribute('data-index');
Â  Â  Â  Â  Â  openMpesaModal();
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  document.querySelectorAll('.delete-btn').forEach(btn => {
Â  Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  const index = e.target.getAttribute('data-index');
Â  Â  Â  Â  Â  deleteBooking(index);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }
  

    // Delete booking function
    function deleteBooking(index) {
      let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
      bookings.splice(index, 1);
      localStorage.setItem('bookings', JSON.stringify(bookings));
      renderBookingDetails();
    }

    // --- Payment Statements View ---
    function renderPaymentStatements() {
      contentDiv.innerHTML = `
        <div class="payment-note">
          Dear customer, you don't have any payment or transaction currently.
        </div>
        <button class="receipt-btn" id="receiptBtn">Get Receipt</button>
      `;
      document.getElementById('receiptBtn').addEventListener('click', () => {
        openReceiptModal();
      });
    }

    // --- Receipt Modal Functions ---
    function openReceiptModal() {
      receiptModal.style.display = 'flex';
    }
    function closeReceiptModal() {
      receiptModal.style.display = 'none';
    }
    closeReceiptBtn.addEventListener('click', closeReceiptModal);

   
    submitMpesaBtn.addEventListener('click', () => {
      const mpesaNo = mpesaNoInput.value.trim();
      // Validate that the Mpesa number has exactly 10 digits
      if (!mpesaNo || !/^\d{10}$/.test(mpesaNo)) {
        alert("Error: Please enter a valid 10-digit Mpesa number.");
        return;
      }
      closeMpesaModal();
      // Show circular spinner for 5 seconds then display payment failed popup
      animationOverlay.style.display = 'flex';
      setTimeout(() => {
        animationOverlay.style.display = 'none';
        paymentFailedModal.style.display = 'flex';
      }, 5000);
    });

    // Payment Failed Popup - Try Again Flow
    tryAgainLink.addEventListener('click', () => {
      paymentFailedModal.style.display = 'none';
      animationOverlay.style.display = 'flex';
      setTimeout(() => {
        animationOverlay.style.display = 'none';
        paymentFailedModal.style.display = 'flex';
      }, 5000);
    });
    closePaymentFailedBtn.addEventListener('click', () => {
      paymentFailedModal.style.display = 'none';
    });

    // --- Logout ---
    logoutLink.addEventListener('click', () => {
      window.location.href = "index.html";
    });

    // --- Navigation Events ---
    homeLink.addEventListener('click', renderHome);
    carsLink.addEventListener('click', renderCars);
    bookingDetailsLink.addEventListener('click', renderBookingDetails);
    paymentsLink.addEventListener('click', renderPaymentStatements);

    // --- Modal Close Events ---
    closeBookingModalBtn.addEventListener('click', closeBookingModal);
    closeMpesaModalBtn.addEventListener('click', closeMpesaModal);
    window.addEventListener('click', function(e) {
      if (e.target === bookingModal) closeBookingModal();
      if (e.target === mpesaModal) closeMpesaModal();
      if (e.target === paymentFailedModal) paymentFailedModal.style.display = 'none';
      if (e.target === receiptModal) closeReceiptModal();
    });

    // --- Initialize with Home View ---
    renderHome();
  </script>
</body>
</html>
