<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Check In</title>
  <style>
    body {
      background: #e6f0ff;
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      padding: 15px;
    }
    h1 {
      color: #003366;
      margin-bottom: 10px;
    }
    video {
      width: 95%;
      max-width: 500px;
      border: 3px solid #003366;
      border-radius: 10px;
      margin: 10px 0;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    button {
      padding: 12px 16px;
      border: none;
      background: #003366;
      color: #fff;
      border-radius: 8px;
      font-size: 15px;
      flex: 1 1 140px;
    }
    button:hover {
      background: #0052cc;
    }
    #timer {
      font-size: 17px;
      margin: 8px 0;
      color: #003366;
    }
    #recordedVideo {
      display: none;
      margin: 10px 0;
    }
    #messageBox {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #003366;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
      z-index: 999;
    }
  </style>
</head>
<body>

  <h1>Car Check In</h1>

  <video id="cameraFeed" autoplay playsinline></video>
  <div id="timer"></div>

  <div class="controls">
    <button onclick="startCamera()">Start Camera</button>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>
    <button onclick="deleteVideo()">Delete Saved Video</button>
  </div>

  <video id="recordedVideo" controls></video>

  <div id="messageBox"></div>

  <script>
    let video = document.getElementById('cameraFeed');
    let recordedVideo = document.getElementById('recordedVideo');
    let messageBox = document.getElementById('messageBox');
    let stream;
    let recorder;
    let chunks = [];
    let timerInterval;
    let seconds = 0;

    function startCamera() {
      navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then(s => {
          stream = s;
          video.srcObject = stream;
          showMessage("Camera started");
        })
        .catch(e => {
          if (e.name === "NotAllowedError") {
            showMessage("Camera permission denied. Enable it in settings.");
          } else {
            showMessage("Error: " + e.message);
          }
        });
    }

    function startRecording() {
      if (!stream) {
        showMessage("Start the camera first");
        return;
      }
      recorder = new MediaRecorder(stream);
      chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = e => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        recordedVideo.src = URL.createObjectURL(blob);
        recordedVideo.style.display = 'block';
        showMessage("Recording saved");
      };
      recorder.start();
      seconds = 0;
      document.getElementById('timer').textContent = "Recording: 0s";
      timerInterval = setInterval(() => {
        seconds++;
        document.getElementById('timer').textContent = `Recording: ${seconds}s`;
      }, 1000);
      showMessage("Recording started");
    }

    function stopRecording() {
      if (recorder && recorder.state === "recording") {
        recorder.stop();
        clearInterval(timerInterval);
        document.getElementById('timer').textContent = "";
        showMessage("Recording stopped");
      } else {
        showMessage("No recording in progress");
      }
    }

    function deleteVideo() {
      if (recordedVideo.src) {
        recordedVideo.src = "";
        recordedVideo.style.display = "none";
        showMessage("Video deleted");
      } else {
        showMessage("No video to delete");
      }
    }

    function showMessage(text) {
      messageBox.textContent = text;
      messageBox.style.display = 'block';
      clearTimeout(messageBox.timeout);
      messageBox.timeout = setTimeout(() => {
        messageBox.style.display = 'none';
      }, 2000);
    }
  </script>
</body>
</html>
