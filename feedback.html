<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Feedback - Waliko Car Hire</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: white; /* Changed background to black */
            color: black; /* Changed text color to white for better visibility on black background */
            text-align: center;
            padding: 20px;
        }
        .feedback-box {
            background: #333; /* Darker background for the box */
            padding: 20px;
            max-width: 400px;
            margin: auto;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2); /* Adjusted shadow for black background */
            position: relative;
            color: white; /* Ensure text in feedback-box is white */
        }
        .stars {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        .star {
            font-size: 30px;
            cursor: pointer;
            color: #ddd; /* Light grey color for stars */
        }
        .star.selected {
            color: gold;
        }
        textarea {
            width: 100%;
            height: 80px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #555; /* Darker border */
            border-radius: 5px;
            background: white; /* Darker background for the textarea */
            color: black; /* Changed text color in textarea to black */
        }
        button {
            width: 100%;
            padding: 15px; /* Increased padding for bigger buttons */
            margin-top: 10px;
            background: #1e90ff; /* Brighter blue for buttons */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font size */
        }
        button:hover {
            background: #0077cc;
        }
        .feedback-display {
            display: none;
            background: #333; /* Darker background for the display */
            padding: 20px;
            margin: auto;
            max-width: 600px; /* Increased width for table */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2); /* Adjusted shadow */
            color: white; /* Ensure text in feedback-display is white */
        }
        .delete-btn, .back-btn {
            background: #ff4d4d; /* Red for delete button */
            margin-top: 10px;
        }
        .back-btn {
            background: #32cd32; /* Green for back button */
        }
        /* Style for the table */
        .feedback-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .feedback-table th, .feedback-table td {
            border: 1px solid #555;
            padding: 8px;
            text-align: left;
        }

        .feedback-table th {
            background-color: #555;
            color: white;
        }

        .feedback-table tr:nth-child(even) {
            background-color: #444;
        }

        /* Responsive table styles */
        @media screen and (max-width: 600px) {
            .feedback-table, .feedback-table tbody, .feedback-table tr, .feedback-table td {
                display: block;
                width: 100%;
            }

            .feedback-table thead {
                display: none; /* Hide table headers on small screens */
            }

            .feedback-table tr {
                margin-bottom: 15px;
                border: 1px solid #555;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

            .feedback-table td {
                text-align: right;
                padding-left: 50%; /* Adjust padding for pseudo-element label */
                position: relative;
                border: none; /* Remove individual cell borders */
                word-wrap: break-word; /* Important for long email addresses */
                word-break: break-all; /* Fallback for older browsers */
            }

            .feedback-table td::before {
                content: attr(data-label); /* Use data-label for content */
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
            }

            /* Adjust button sizes for mobile */
            button {
                padding: 10px; /* Smaller padding */
                font-size: 1em; /* Slightly smaller font size */
                width: calc(100% - 20px); /* Adjust width to avoid overflow from padding on the parent */
                margin-left: 10px; /* Center with a margin if needed */
                margin-right: 10px;
            }

            /* Adjust the feedback display max-width for smaller screens if needed */
            .feedback-display {
                max-width: 95%; /* Adjust max-width to give more room */
                padding: 15px; /* Slightly less padding */
            }

            .feedback-box {
                max-width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="feedback-box" id="feedbackBox">
        <button onclick="window.location.href='car-available.html'" style="position: absolute; top: -10px; right: -10px; border: none; background: none; font-size: 1.2em; cursor: pointer; color: #888; border-radius: 50%; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center;">&times;</button>
        <h2>Give Your Feedback</h2>
        <p>Rate our system</p>
        <div class="stars" id="stars">
            <span class="star" data-value="1">â˜…</span>
            <span class="star" data-value="2">â˜…</span>
            <span class="star" data-value="3">â˜…</span>
            <span class="star" data-value="4">â˜…</span>
            <span class="star" data-value="5">â˜…</span>
        </div>
        <textarea id="feedbackText" placeholder="Tell us about your experience..."></textarea>
        <button onclick="submitFeedback()">Submit Feedback</button>
    </div>

    <div class="feedback-display" id="feedbackDisplay">
        <h2>Your Feedback</h2>
        <table class="feedback-table">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Rating</th>
                    <th>Message</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="feedbackEmail" data-label="Email"></td>
                    <td id="feedbackStars" data-label="Rating"></td>
                    <td id="feedbackMessage" data-label="Message"></td>
                    <td id="feedbackTime" data-label="Time"></td>
                </tr>
            </tbody>
        </table>
        <button class="delete-btn" onclick="deleteFeedback()">Delete Feedback</button>
        <button class="back-btn" onclick="window.location.href='car-available.html'">Back</button>
    </div>

    <script>
        let selectedRating = 0;

        document.addEventListener("DOMContentLoaded", function() {
            retrieveFeedback();
        });

        // Handle star click to set rating
        document.querySelectorAll(".star").forEach(star => {
            star.addEventListener("click", function() {
                selectedRating = parseInt(this.getAttribute("data-value"));
                updateStars(selectedRating);
            });
        });

        // Update star colors based on selected rating
        function updateStars(rating) {
            document.querySelectorAll(".star").forEach(star => {
                let starValue = parseInt(star.getAttribute("data-value"));
                if (starValue <= rating) {
                    star.classList.add("selected");
                } else {
                    star.classList.remove("selected");
                }
            });
        });

        // Get user email from currentUser in localStorage
        function getUserEmail() {
            let user = JSON.parse(localStorage.getItem("currentUser"));
            return user ? user.email : "Unknown";
        }

        // Submit feedback
        function submitFeedback() {
            let userEmail = getUserEmail();
            let message = document.getElementById("feedbackText").value.trim();

            if (!selectedRating || message === "") {
                alert("âŒ Please provide a rating and message before submitting.");
                return;
            }

            // Prevent submission if user is not logged in (email is 'Unknown')
            if (userEmail === "Unknown") {
                alert("ðŸ”’ You must be logged in to submit feedback.");
                return;
            }

            // Check if feedback already exists in localStorage
            if (localStorage.getItem("userFeedback")) {
                alert("âŒ You already submitted feedback. Please delete your previous feedback to submit again.");
                retrieveFeedback();
                return;
            }

            let feedbackData = {
                email: userEmail,
                rating: selectedRating,
                message: message,
                time: new Date().toLocaleString()
            };

            // Store feedback in localStorage
            localStorage.setItem("userFeedback", JSON.stringify(feedbackData));
            displayFeedback();
        }

        // Retrieve and display feedback if exists
        function retrieveFeedback() {
            let storedFeedback = JSON.parse(localStorage.getItem("userFeedback"));
            if (storedFeedback) {
                document.getElementById("feedbackBox").style.display = "none";
                document.getElementById("feedbackDisplay").style.display = "block";

                document.getElementById("feedbackEmail").textContent = storedFeedback.email;
                document.getElementById("feedbackStars").textContent = "â˜…".repeat(storedFeedback.rating);
                document.getElementById("feedbackMessage").textContent = storedFeedback.message;
                document.getElementById("feedbackTime").textContent = storedFeedback.time; // Display the time
            }
        }

        // Delete feedback
        function deleteFeedback() {
            localStorage.removeItem("userFeedback");
            document.getElementById("feedbackDisplay").style.display = "none";
            document.getElementById("feedbackBox").style.display = "block";
            // Reset the form after deletion
            selectedRating = 0;
            updateStars(0);
            document.getElementById("feedbackText").value = "";
        }

        // Display stored feedback
        function displayFeedback() {
            let feedbackData = JSON.parse(localStorage.getItem("userFeedback"));
            if (feedbackData) {
                document.getElementById("feedbackBox").style.display = "none";
                document.getElementById("feedbackDisplay").style.display = "block";

                document.getElementById("feedbackEmail").textContent = feedbackData.email;
                document.getElementById("feedbackStars").textContent = "â˜…".repeat(feedbackData.rating);
                document.getElementById("feedbackMessage").textContent = feedbackData.message;
                document.getElementById("feedbackTime").textContent = feedbackData.time;
            }
        }
    </script>

</body>
</html>
